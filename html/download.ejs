<!--
  This Source Code Form is subject to the terms of the GNU General Public License:

  Copyright (C) 2021-2026 poke (https://codeberg.org/Ashley/poketube)

  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU General Public License as published by
  the Free Software Foundation, either version 3 of the License, or
  (at your option) any later version.

  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU General Public License for more details.

  You should have received a copy of the GNU General Public License
  along with this program. If not, see https://www.gnu.org/licenses/.
-->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Poke | Download Video</title>
  <meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" />
  <meta name="theme-color" content="<%= color %>"/>
  <meta property="og:type" content="website" />
  <meta property="og:title" content="PokeTube - Video Downloader" />
  <meta property="og:image" content="https://i.ytimg.com/vi/<%= v %>/maxresdefault.jpg" />
  
  <link rel="icon" href="/css/yt-ukraine.svg?v=7" />
  <link rel="manifest" href="/manifest.json" />
  <link rel="preconnect" href="https://fonts.poketube.fun" crossorigin />
  <link href="https://fonts.poketube.fun/css/fonts.css" rel="stylesheet" />
  <link href="https://p.poketube.fun/https://site-assets.fontawesome.com/releases/v6.1.1/css/all.css" rel="stylesheet" />
  
  <style>
    :root {
      /* Core Palette */
      --brand: <%= color %>;
      --bg-dark: #050505;
      --bg-glass: rgba(20, 20, 23, 0.7);
      --bg-glass-border: rgba(255, 255, 255, 0.08);
      --bg-hover: rgba(255, 255, 255, 0.05);
      
      --text-main: #ececf1;
      --text-muted: #94949e;
      --text-link: #5eb1ff;
      
      /* Layout & Spacing */
      --radius-lg: 24px;
      --radius-md: 16px;
      --radius-sm: 8px;
      --pad: clamp(16px, 3vw, 24px);
      
      /* Effects */
      --shadow-lg: 0 24px 48px -12px rgba(0, 0, 0, 0.5);
      --shadow-sm: 0 4px 12px rgba(0, 0, 0, 0.1);
      --blur: blur(20px);
      --glow: 0 0 20px var(--brand);
    }

    @font-face {
      src: url("/static/robotoflex.ttf");
      font-family: "PokeTube Flex";
      font-style: normal;
      font-stretch: 1% 800%;
      font-display: swap;
    }

    /* --- Base --- */
    *, *::before, *::after { box-sizing: border-box; }
    
    body {
      margin: 0;
      color: var(--text-main);
      background-color: var(--bg-dark);
      font-family: "PokeTube Flex", sans-serif;
      -webkit-font-smoothing: antialiased;
      line-height: 1.5;
    }

    /* Seamless Dynamic Background */
    body::before {
      content: "";
      position: fixed; inset: 0; z-index: -1;
      background: 
        radial-gradient(circle at 15% 50%, rgba(var(--brand), 0.15), transparent 40%),
        radial-gradient(circle at 85% 30%, rgba(78, 46, 130, 0.25), transparent 40%),
        linear-gradient(135deg, #0f0c14 0%, #050505 100%);
      background-size: cover;
    }
    
    /* Scrollbar */
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.15); border-radius: 99px; }
    ::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.3); }

    a { color: inherit; text-decoration: none; transition: 0.2s; }
    
    /* --- Topbar --- */
    .topbar {
      position: sticky; top: 0; z-index: 100;
      display: flex; align-items: center; justify-content: space-between;
      padding: 12px var(--pad);
      background: rgba(5, 5, 5, 0.8);
      backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
      border-bottom: 1px solid var(--bg-glass-border);
    }
    
    .brand img { height: 26px; display: block; }
    
    .actions { display: flex; gap: 8px; }
    .icon-btn {
      width: 40px; height: 40px;
      display: grid; place-items: center;
      border-radius: 50%;
      background: rgba(255,255,255,0.03);
      color: var(--text-muted);
      border: 1px solid transparent;
      transition: all 0.2s ease;
    }
    .icon-btn:hover {
      background: rgba(255,255,255,0.1);
      color: #fff;
      transform: translateY(-2px);
    }

    /* --- Main Layout --- */
    .container {
      max-width: 1100px;
      margin: 0 auto;
      padding: clamp(20px, 5vw, 40px) var(--pad);
      animation: fadeIn 0.6s ease-out;
    }

    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    /* --- Panels & Cards --- */
    .panel {
      background: var(--bg-glass);
      border: 1px solid var(--bg-glass-border);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-lg);
      overflow: hidden;
      backdrop-filter: var(--blur);
    }

    .panel-header {
      display: grid;
      grid-template-columns: 1fr 320px;
      gap: 32px;
      padding: 32px;
      border-bottom: 1px solid var(--bg-glass-border);
    }
    @media (max-width: 850px) { .panel-header { grid-template-columns: 1fr; } }

    .title h1 {
      font-size: clamp(24px, 4vw, 36px);
      font-weight: 850;
      margin: 0 0 8px;
      letter-spacing: -0.5px;
      background: linear-gradient(to bottom right, #fff, #ccc);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .subtitle { font-size: 14px; color: var(--text-muted); font-family: monospace; margin-bottom: 12px; }
    .subtitle a { color: var(--text-link); border-bottom: 1px dotted var(--text-link); }
    .helper { color: var(--text-muted); font-size: 14px; margin: 0; line-height: 1.6; }

    /* Thumbnail */
    .thumb-wrap {
      margin: 0; position: relative;
      border-radius: var(--radius-md);
      overflow: hidden;
      box-shadow: 0 8px 24px rgba(0,0,0,0.3);
      border: 1px solid rgba(255,255,255,0.1);
      transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    .thumb-wrap:hover { transform: scale(1.02); box-shadow: 0 0 30px var(--brand); border-color: var(--brand); }
    .thumb { width: 100%; aspect-ratio: 16/9; object-fit: cover; display: block; }

    /* --- Formats Section --- */
    .formats { padding: 32px; }
    .section { margin-bottom: 40px; }
    .section:last-child { margin-bottom: 0; }
    
    .section h2 {
      font-size: 18px;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: var(--text-muted);
      margin: 0 0 16px;
      display: flex; align-items: center; gap: 12px;
    }
    .section h2::after { content:""; height: 1px; background: var(--bg-glass-border); flex: 1; }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 16px;
    }

    /* --- Format Chips --- */
    .chip {
      display: flex; align-items: center; justify-content: space-between;
      padding: 16px 20px;
      background: rgba(255,255,255,0.03);
      border: 1px solid var(--bg-glass-border);
      border-radius: var(--radius-md);
      transition: all 0.2s;
      position: relative;
      overflow: hidden;
    }
    .chip:hover {
      background: rgba(255,255,255,0.06);
      border-color: rgba(255,255,255,0.2);
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.2);
    }
    .chip:focus-within { border-color: var(--brand); box-shadow: 0 0 0 2px var(--brand); }

    .chip .meta { display: flex; flex-direction: column; gap: 2px; }
    .chip .label { font-weight: 700; font-size: 15px; color: #fff; }
    .chip .hint { font-size: 12px; color: var(--text-muted); }

    /* Download Button */
    .btn {
      display: inline-flex; align-items: center; gap: 8px;
      height: 36px; padding: 0 16px;
      border-radius: 99px;
      background: #fff;
      color: #000;
      font-weight: 700;
      font-size: 13px;
      border: none;
      cursor: pointer;
      transition: all 0.2s;
    }
    .btn:hover { background: #e0e0e0; transform: scale(1.05); }
    .btn:active { transform: scale(0.95); }
    .btn i { font-size: 14px; }

    /* Alert Box */
    .alert {
      display: flex; align-items: center; gap: 12px;
      margin: 24px 0 40px;
      padding: 16px;
      background: linear-gradient(90deg, rgba(33, 150, 243, 0.2) 0%, rgba(33, 150, 243, 0.05) 100%);
      border: 1px solid rgba(33, 150, 243, 0.3);
      color: #90caf9;
      border-radius: var(--radius-md);
      font-size: 14px;
    }
    .alert::before { content: "\f05a"; font-family: "Font Awesome 6 Pro"; font-weight: 900; font-size: 16px; }

    /* --- Mux (How To) Section --- */
    .mux-card {
      background: rgba(0,0,0,0.3);
      border: 1px solid var(--bg-glass-border);
      border-radius: var(--radius-lg);
      padding: 32px;
    }
    
    .mux-rows {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 20px;
      margin-top: 24px;
    }

    .mux-item {
      display: flex; flex-direction: column;
      background: #0e0e10;
      border: 1px solid #2a2a30;
      border-radius: var(--radius-md);
      overflow: hidden;
      transition: border-color 0.2s;
    }
    .mux-item:hover { border-color: #4a4a50; }

    .mux-header {
      padding: 12px 16px;
      background: #18181b;
      border-bottom: 1px solid #2a2a30;
      font-size: 13px;
      font-weight: 700;
      color: #fff;
      display: flex; justify-content: space-between; align-items: center;
    }

    /* Terminal Look for Code */
    .terminal-window {
      padding: 16px;
      font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
      font-size: 12px;
      color: #a6accd;
      background: #09090b;
      flex-grow: 1;
      display: flex; flex-direction: column; gap: 12px;
    }
    
    .kbd {
      display: block;
      color: #43d9ad; /* Terminal Green/Cyan */
      line-height: 1.5;
      word-break: break-all;
      background: transparent; border: none; padding: 0;
    }
    
    /* Copy Button Styled */
    .copy-action {
      align-self: flex-start;
      margin-top: auto;
      background: rgba(255,255,255,0.08);
      border: 1px solid rgba(255,255,255,0.05);
      color: #fff;
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 11px;
      cursor: pointer;
      display: inline-flex; align-items: center; gap: 6px;
      transition: background 0.2s;
    }
    .copy-action:hover { background: rgba(255,255,255,0.15); }
    
    /* Screen Reader Utilities */
    .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; overflow: hidden; clip: rect(0,0,0,0); border: 0; }
  </style>
</head>
<body>
  <header class="topbar" role="banner">
    <a class="brand" href="/143" aria-label="Poke home">
      <img src="/css/logo-poke.svg?v=5" alt="Poke logo" />
    </a>
    <div class="actions" role="group" aria-label="Quick actions">
      <a class="icon-btn" href="/privacy" title="Privacy"><i class="fa-light fa-shield"></i></a>
      <a class="icon-btn" href="/video/upload?from=" title="Upload video"><i class="fa-light fa-video"></i></a>
      <a class="icon-btn" href="https://codeberg.org/Ashley/poketube/" title="Source code"><i class="fab fa-git-alt"></i></a>
      <a class="icon-btn" href="https://codeberg.org/Ashley/poketube/issues" title="Report a bug"><i class="fa-light fa-bug"></i></a>
    </div>
  </header>

  <main class="container">
    <section class="panel" aria-labelledby="download-title">
      <div class="panel-header">
        <div class="title">
          <h1 id="download-title">Download Media</h1>
          <div class="subtitle">ID: <code><%= v %></code> — <a href="/watch?v=<%= v %>">Open watch page</a></div>
          <p class="helper">Select a format to download :3 Muxed is audio+video and Video only needs a separate audio track if you plan to mux!</p>
        </div>
        <figure class="thumb-wrap">
          <img class="thumb" src="/vi/<%= v %>/maxresdefault.jpg" alt="Video thumbnail" loading="eager" />
        </figure>
      </div>

      <div class="formats">
        <section class="section">
          <h2 id="muxed"><span><i class="fa-light fa-film-canister"></i> Muxed Formats</span></h2>
          <div class="grid">
            <article class="chip">
              <div class="meta">
                <span class="label">MP4 — 480p</span>
                <span class="hint">Audio + Video • Ready to play</span>
              </div>
              <a class="btn" href="/api/video/download?v=<%= v %>&q=18"><i class="fa-light fa-download"></i> Download</a>
            </article>
          </div>
        </section>

        <section class="section">
          <h2 id="audio"><span><i class="fa-light fa-music"></i> Audio Only</span></h2>
          <div class="grid">
            <article class="chip">
              <div class="meta"><span class="label">m4a — low</span><span class="hint">Small size</span></div>
              <a class="btn" href="/api/video/download?v=<%= v %>&q=139&f=webm"><i class="fa-light fa-download"></i> Get</a>
            </article>
            <article class="chip">
              <div class="meta"><span class="label">m4a — high</span><span class="hint">Best Quality</span></div>
              <a class="btn" href="/api/video/download?v=<%= v %>&q=140&f=webm"><i class="fa-light fa-download"></i> Get</a>
            </article>
            <article class="chip">
              <div class="meta"><span class="label">webm — low</span><span class="hint">Opus • Efficient</span></div>
              <a class="btn" href="/api/video/download?v=<%= v %>&q=249&f=webm"><i class="fa-light fa-download"></i> Get</a>
            </article>
            <article class="chip">
              <div class="meta"><span class="label">webm — high</span><span class="hint">Opus • High Bitrate</span></div>
              <a class="btn" href="/api/video/download?v=<%= v %>&q=251&f=webm"><i class="fa-light fa-download"></i> Get</a>
            </article>
          </div>
        </section>

        <section class="section">
          <h2 id="videoonly"><span><i class="fa-light fa-video-slash"></i> Video Only</span></h2>
          <p class="helper" style="margin-bottom:16px">No audio!! You may need to mux with an audio track :c</p>
          <div class="grid">
            <article class="chip">
              <div class="meta"><span class="label">144p — MP4</span></div>
              <a class="btn" href="/api/video/download?v=<%= v %>&q=160&f=mp4"><i class="fa-light fa-download"></i> Get</a>
            </article>
            <article class="chip">
              <div class="meta"><span class="label">144p — WEBM</span></div>
              <a class="btn" href="/api/video/download?v=<%= v %>&q=278&f=webm"><i class="fa-light fa-download"></i> Get</a>
            </article>
            <article class="chip">
              <div class="meta"><span class="label">240p — MP4</span></div>
              <a class="btn" href="/api/video/download?v=<%= v %>&q=133&f=mp4"><i class="fa-light fa-download"></i> Get</a>
            </article>
            <article class="chip">
              <div class="meta"><span class="label">240p — WEBM</span></div>
              <a class="btn" href="/api/video/download?v=<%= v %>&q=242&f=webm"><i class="fa-light fa-download"></i> Get</a>
            </article>
            <article class="chip">
              <div class="meta"><span class="label">360p — MP4</span></div>
              <a class="btn" href="/api/video/download?v=<%= v %>&q=134&f=mp4"><i class="fa-light fa-download"></i> Get</a>
            </article>
            <article class="chip">
              <div class="meta"><span class="label">360p — WEBM</span></div>
              <a class="btn" href="/api/video/download?v=<%= v %>&q=243&f=webm"><i class="fa-light fa-download"></i> Get</a>
            </article>
            <article class="chip">
              <div class="meta"><span class="label">480p — MP4</span></div>
              <a class="btn" href="/api/video/download?v=<%= v %>&q=135&f=mp4"><i class="fa-light fa-download"></i> Get</a>
            </article>
            <article class="chip">
              <div class="meta"><span class="label">480p — WEBM</span></div>
              <a class="btn" href="/api/video/download?v=<%= v %>&q=244&f=webm"><i class="fa-light fa-download"></i> Get</a>
            </article>
            <article class="chip">
              <div class="meta"><span class="label">720p — MP4</span></div>
              <a class="btn" href="/api/video/download?v=<%= v %>&q=136&f=mp4"><i class="fa-light fa-download"></i> Get</a>
            </article>
            <article class="chip">
              <div class="meta"><span class="label">720p — WEBM</span></div>
              <a class="btn" href="/api/video/download?v=<%= v %>&q=247&f=webm"><i class="fa-light fa-download"></i> Get</a>
            </article>
            <article class="chip">
              <div class="meta"><span class="label">1080p — MP4</span></div>
              <a class="btn" href="/api/video/download?v=<%= v %>&q=137&f=mp4"><i class="fa-light fa-download"></i> Get</a>
            </article>
            <article class="chip">
              <div class="meta"><span class="label">1080p — WEBM</span></div>
              <a class="btn" href="/api/video/download?v=<%= v %>&q=248&f=webm"><i class="fa-light fa-download"></i> Get</a>
            </article>
          </div>
        </section>

        <div class="alert" role="status">
          <span>if a download fails try another container (MP4 vs WEBM) or a different quality :D</span>
        </div>

        <section class="mux-card" aria-labelledby="combine">
          <h2 id="combine" style="margin:0; font-size: 20px; font-weight: 800;">How2 Combine video-only + audio-only (mux)</h2>
          <p class="helper">U can pick one of these methods!!</p>

          <div class="mux-rows">
            <div class="mux-item">
              <div class="mux-header">
                <span><i class="fab fa-linux"></i> FFmpeg — MP4 output</span>
              </div>
              <div class="terminal-window">
                <span class="helper" style="font-size:11px; margin:0">when your video is MP4 (H.264) and audio is M4A/AAC use dis!</span>
                <code class="kbd" data-code="ffmpeg -i video.mp4 -i videoplayback.m4a -c copy -map 0:v:0 -map 1:a:0 output.mp4">
                  ffmpeg -i video.mp4 -i videoplayback.m4a -c copy -map 0:v:0 -map 1:a:0 output.mp4
                </code>
                <button class="copy-action" data-target="prev"><i class="fa-light fa-copy"></i> Copy Command</button>
              </div>
            </div>

            <div class="mux-item">
              <div class="mux-header">
                <span><i class="fab fa-linux"></i> FFmpeg — WEBM output</span>
              </div>
              <div class="terminal-window">
                <span class="helper" style="font-size:11px; margin:0">when both tracks are WEBM (VP9/AV1 + Opus) use dis!</span>
                <code class="kbd" data-code="ffmpeg -i videoplayback.webm -i audio.webm -c copy -map 0:v:0 -map 1:a:0 output.webm">
                  ffmpeg -i videoplayback.webm -i audio.webm -c copy -map 0:v:0 -map 1:a:0 output.webm
                </code>
                <button class="copy-action" data-target="prev"><i class="fa-light fa-copy"></i> Copy Command</button>
              </div>
            </div>

            <div class="mux-item">
              <div class="mux-header">
                <span><i class="fa-light fa-file-video"></i> FFmpeg — Mixed</span>
              </div>
              <div class="terminal-window">
                <span class="helper" style="font-size:11px; margin:0">If containers differ u can mux to mkv for best compatibility!</span>
                <code class="kbd" data-code="ffmpeg -i videoplayback.webm -i videoplayback.m4a -c copy -map 0:v:0 -map 1:a:0 output.mkv">
                  ffmpeg -i videoplayback.webm -i videoplayback.m4a -c copy -map 0:v:0 -map 1:a:0 output.mkv
                </code>
                <button class="copy-action" data-target="prev"><i class="fa-light fa-copy"></i> Copy Command</button>
              </div>
            </div>

            <div class="mux-item">
              <div class="mux-header"><span><i class="fab fa-windows"></i> Windows</span></div>
              <div class="terminal-window">
                <pre class="kbd" style="white-space: pre-wrap;">1) Install FFmpeg (add to PATH)
2) Put video and audio next to each other
3) Open Terminal in that folder and run one of the commands above</pre>
              </div>
            </div>

            <div class="mux-item">
              <div class="mux-header"><span><i class="fab fa-apple"></i> macOS / Linux</span></div>
              <div class="terminal-window">
                <pre class="kbd" style="white-space: pre-wrap;"># Example
ffmpeg -i video.mp4 -i videoplayback.m4a -c copy -map 0:v:0 -map 1:a:0 output.mp4</pre>
              </div>
            </div>

            <div class="mux-item">
              <div class="mux-header"><span><i class="fab fa-android"></i> Android (Termux)</span></div>
              <div class="terminal-window">
                <pre class="kbd" style="white-space: pre-wrap;">pkg install ffmpeg
cd /sdcard/Download
ffmpeg -i videoplayback.webm -i audio.webm -c copy -map 0:v:0 -map 1:a:0 output.webm</pre>
              </div>
            </div>
          </div>
        </section>
      </div>
    </section>
  </main>

  <script src="/css/custom-css.js?v=54"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Accessible Click on Chips
      document.querySelectorAll('.chip').forEach(chip => {
        const btn = chip.querySelector('.btn');
        if(!btn) return;
        chip.style.cursor = 'pointer';
        chip.addEventListener('click', (e) => {
           // Prevent double firing if clicking the button directly
           if(e.target !== btn && !btn.contains(e.target)) btn.click();
        });
        chip.addEventListener('keydown', e => {
          if (e.key === 'Enter' || e.key === ' ') { 
            e.preventDefault(); 
            btn.click(); 
          }
        });
      });

      // Copy Functionality
      const toClipboard = async (text, el) => {
        try {
          await navigator.clipboard.writeText(text);
          const icon = el.querySelector('i');
          const originalClass = icon.className;
          const originalText = el.innerText;
          
          el.innerHTML = '<i class="fa-light fa-check"></i> Copied!';
          el.style.borderColor = '#43d9ad';
          el.style.color = '#43d9ad';
          
          setTimeout(() => { 
            el.innerHTML = `<i class="${originalClass}"></i> Copy Command`;
            el.style.borderColor = '';
            el.style.color = '';
          }, 1500);
        } catch (_) {
          console.error("Copy failed");
        }
      };

      document.querySelectorAll('.copy-action').forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.stopPropagation();
          const target = btn.dataset.target === 'prev' ? btn.previousElementSibling : document.querySelector(btn.dataset.target);
          const code = target?.dataset.code || target?.innerText || '';
          if (code.trim()) toClipboard(code.trim(), btn);
        });
      });
    });
  </script>
</body>
</html>