<!DOCTYPE html>
<html class="gradient-bg" lang="en">
<head>
  <meta charset="utf-8" />
  <title>PokeTube | Customize</title>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <link href="/css/yt-ukraine.svg?v=6" rel="icon">
  
  <link rel="stylesheet" href="https://p.poketube.fun/https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css">
  <link rel="stylesheet" href="https://p.poketube.fun/https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/dracula.min.css">
  <link rel="stylesheet" href="https://p.poketube.fun/https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/scroll/simplescrollbars.min.css">

  <style>
     @import url("https://p.poketube.fun/https://site-assets.fontawesome.com/releases/v6.1.1/css/all.css");

    :root {
      --bg: #0c0c0f; --panel: #121218; --panel-glass: rgba(18, 18, 24, 0.65);
      --text: #e9ecf1; --muted: #aab2c0;
      --accent: #7cc7ff; --accent-glow: rgba(124,199,255,0.4);
      --border: rgba(255,255,255,0.08);
      --radius: 16px; --radius-sm: 8px;
      --font-main: 'Inter', system-ui, -apple-system, sans-serif;
      --font-mono: 'JetBrains Mono', 'Fira Code', monospace;
    }

    /* Base Setup */
    * { box-sizing: border-box; outline: none; }
    body {
      margin: 0; color: var(--text); font-family: var(--font-main);
      background: #0a0a0f; overflow-x: hidden; min-height: 100vh;
    }

    /* Advanced Background */
    html.gradient-bg {
      background:
        radial-gradient(circle at 15% 10%, rgba(249, 119, 148, 0.15), transparent 40%),
        radial-gradient(circle at 85% 30%, rgba(124, 199, 255, 0.12), transparent 40%),
        linear-gradient(180deg, #0a0a0f 0%, #0d0e15 100%);
      background-attachment: fixed;
    }

    /* Navbar */
    .navbar {
      display: flex; align-items: center; justify-content: space-between;
      padding: 0 24px; height: 70px;
      position: sticky; top: 0; z-index: 100;
      backdrop-filter: blur(16px) saturate(180%);
      background: rgba(10, 10, 15, 0.7);
      border-bottom: 1px solid var(--border);
    }
    .navbar__logo { height: 28px; display: block; filter: drop-shadow(0 0 8px rgba(255,255,255,0.2)); }
    
    .navbar__search {
      flex: 1; max-width: 500px; margin: 0 20px; position: relative;
    }
    .search-input {
      width: 100%; background: rgba(255,255,255,0.05);
      border: 1px solid var(--border); border-radius: 99px;
      padding: 10px 45px 10px 20px; color: #fff; transition: 0.2s;
    }
    .search-input:focus { background: rgba(0,0,0,0.4); border-color: var(--accent); box-shadow: 0 0 0 4px rgba(124,199,255,0.1); }
    .search-btn {
      position: absolute; right: 5px; top: 50%; transform: translateY(-50%);
      background: none; border: none; color: var(--muted); cursor: pointer; padding: 8px;
    }

    .navbar__actions { display: flex; gap: 12px; }
    .nav-icon {
      width: 40px; height: 40px; border-radius: 12px;
      display: grid; place-items: center; color: var(--text);
      background: rgba(255,255,255,0.03); border: 1px solid var(--border);
      text-decoration: none; transition: 0.2s;
    }
    .nav-icon:hover { background: rgba(255,255,255,0.1); color: var(--accent); }

    /* Layout */
    .container { max-width: 1200px; margin: 40px auto; padding: 0 20px; }
    
    .header { margin-bottom: 30px; }
    .header h1 { font-size: 32px; margin: 0; font-weight: 800; letter-spacing: -0.5px; }
    .header p { color: var(--muted); margin: 8px 0 0; }

    /* Tabs */
    .tabs {
      display: inline-flex; background: rgba(0,0,0,0.3);
      padding: 4px; border-radius: 12px; border: 1px solid var(--border);
      margin-bottom: 24px;
    }
    .tab {
      padding: 8px 24px; border-radius: 8px; color: var(--muted);
      text-decoration: none; font-size: 14px; font-weight: 600;
      transition: 0.2s;
    }
    .tab:hover { color: #fff; }
    .tab.active { background: var(--accent); color: #000; box-shadow: 0 4px 12px var(--accent-glow); }

    /* Editor Panel */
    .editor-card {
      background: var(--panel-glass); border: 1px solid var(--border);
      border-radius: var(--radius); overflow: hidden;
      box-shadow: 0 20px 40px rgba(0,0,0,0.4);
      display: flex; flex-direction: column; height: 75vh;
    }

    .editor-toolbar {
      padding: 12px 20px; background: rgba(0,0,0,0.2);
      border-bottom: 1px solid var(--border);
      display: flex; justify-content: space-between; align-items: center;
    }
    .editor-info { font-size: 13px; color: var(--muted); display: flex; gap: 10px; align-items: center; }
    .badge { background: rgba(255,255,255,0.1); padding: 2px 6px; border-radius: 4px; font-family: var(--font-mono); font-size: 11px; }

    .btn-group { display: flex; gap: 8px; }
    .btn {
      border: 1px solid var(--border); background: rgba(255,255,255,0.05);
      color: #fff; padding: 6px 14px; border-radius: 6px;
      font-size: 13px; cursor: pointer; transition: 0.2s; display: flex; align-items: center; gap: 6px;
    }
    .btn:hover { background: rgba(255,255,255,0.1); }
    .btn.primary { background: var(--accent); color: #000; border-color: transparent; font-weight: 600; }
    .btn.primary:hover { filter: brightness(1.1); }
    .btn.danger { color: #ff5b5b; border-color: rgba(255,91,91,0.3); }
    .btn.danger:hover { background: rgba(255,91,91,0.1); }

    /* CodeMirror Overrides */
    .CodeMirror {
      flex: 1; height: auto !important;
      font-family: var(--font-mono) !important; font-size: 14px;
      background: transparent !important;
    }
    .cm-s-dracula.CodeMirror { background: rgba(0,0,0,0.2) !important; }
    .CodeMirror-gutters { background: rgba(0,0,0,0.3) !important; border-right: 1px solid var(--border) !important; }

    /* Toast Notification */
    .toast-container {
      position: fixed; bottom: 30px; right: 30px; z-index: 2000;
      display: flex; flex-direction: column; gap: 10px;
    }
    .toast {
      background: #1a1b26; color: #fff; padding: 12px 20px;
      border-radius: 8px; border: 1px solid var(--border);
      box-shadow: 0 8px 20px rgba(0,0,0,0.5);
      font-size: 14px; display: flex; align-items: center; gap: 10px;
      animation: slideIn 0.3s cubic-bezier(0.16, 1, 0.3, 1);
    }
    .toast i { color: var(--accent); }
    @keyframes slideIn { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

  </style>
</head>
<body>

  <nav class="navbar">
    <div class="navbar__left">
      <a href="/143"><img class="navbar__logo" src="/css/logo.svg?v=5" alt="PokeTube"></a>
    </div>
    <form class="navbar__search" action="/search">
      <input name="query" class="search-input" type="search" placeholder="Search videos, channelsâ€¦" />
      <button class="search-btn" type="submit"><i class="fa-light fa-search"></i></button>
    </form>
    <div class="navbar__actions">
      <a class="nav-icon" href="/domains" title="Domains"><i class="fa-light fa-server"></i></a>
      <a class="nav-icon" href="/privacy" title="Privacy"><i class="fa-light fa-shield"></i></a>
      <a class="nav-icon" href="/video/upload" title="Upload"><i class="fa-light fa-video"></i></a>
    </div>
  </nav>

  <div class="container">
    <div class="header">
      <h1>Customize Poke</h1>
      <p>Theme your experience with custom scripts and styles.</p>
    </div>

    <div class="tabs">
      <% if (!tab) { %>
        <a class="tab active" href="/customize">CSS Styles</a>
        <a class="tab" href="/customize?tab=js">JS Scripts</a>
      <% } else { %>
        <a class="tab" href="/customize">CSS Styles</a>
        <a class="tab active" href="/customize?tab=js">JS Scripts</a>
      <% } %>
    </div>

    <% if (!tab) { %>
    <div class="editor-card">
      <div class="editor-toolbar">
        <div class="editor-info">
          <i class="fa-brands fa-css3 text-accent"></i>
          <span>Global CSS</span>
          <span class="badge">localStorage['poke-custom-css']</span>
        </div>
        <div class="btn-group">
          <button class="btn primary" onclick="saveEditor('css')"><i class="fa-solid fa-floppy-disk"></i> Save</button>
          <button class="btn" onclick="copyEditor('css')"><i class="fa-regular fa-copy"></i> Copy</button>
          <button class="btn" onclick="downloadEditor('css')"><i class="fa-solid fa-download"></i> Export</button>
          <button class="btn danger" onclick="resetEditor('css')"><i class="fa-solid fa-trash"></i> Reset</button>
        </div>
      </div>
      <textarea id="css-area"></textarea>
    </div>
    <% } %>

    <% if (tab) { %>
    <div class="editor-card">
      <div class="editor-toolbar">
        <div class="editor-info">
          <i class="fa-brands fa-js text-accent"></i>
          <span>Global Script</span>
          <span class="badge">localStorage['poke-custom-script']</span>
        </div>
        <div class="btn-group">
          <button class="btn primary" onclick="saveEditor('js')"><i class="fa-solid fa-floppy-disk"></i> Save</button>
          <button class="btn" onclick="copyEditor('js')"><i class="fa-regular fa-copy"></i> Copy</button>
          <button class="btn" onclick="downloadEditor('js')"><i class="fa-solid fa-download"></i> Export</button>
          <button class="btn danger" onclick="resetEditor('js')"><i class="fa-solid fa-trash"></i> Reset</button>
        </div>
      </div>
      <textarea id="js-area"></textarea>
    </div>
    <% } %>
  </div>

  <div class="toast-container" id="toaster"></div>

  <script src="https://p.poketube.fun/https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.js"></script>
  <script src="https://p.poketube.fun/https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/css/css.min.js"></script>
  <script src="https://p.poketube.fun/https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/javascript/javascript.min.js"></script>
  <script src="https://p.poketube.fun/https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/edit/closebrackets.min.js"></script>

  <script>
     const CONFIG = {
      css: { key: 'poke-custom-css', mode: 'css', default: '/* \n  PokeTube Custom CSS\n  Go wild! \n*/\n\nbody {\n  \n}' },
      js:  { key: 'poke-custom-script', mode: 'javascript', default: '// \n// PokeTube Custom Script\n//\n\nconsole.log("PokeTube Loaded");' }
    };

    let editorInstance = null;

    document.addEventListener('DOMContentLoaded', () => {
      <% if (!tab) { %> initEditor('css'); <% } %>
      <% if (tab) { %> initEditor('js'); <% } %>
    });

    function initEditor(type) {
      const textarea = document.getElementById(type + '-area');
      const savedContent = localStorage.getItem(CONFIG[type].key) || CONFIG[type].default;
      
      textarea.value = savedContent;

      editorInstance = CodeMirror.fromTextArea(textarea, {
        mode: CONFIG[type].mode,
        theme: 'dracula',
        lineNumbers: true,
        autoCloseBrackets: true,
        tabSize: 2,
        lineWrapping: true,
        extraKeys: {"Ctrl-Space": "autocomplete"}
      });

      // Live CSS Preview
      if (type === 'css') {
        const previewStyle = document.createElement('style');
        previewStyle.id = 'live-preview-style';
        document.body.appendChild(previewStyle);
        
        // Initial load
        previewStyle.textContent = savedContent;

        editorInstance.on('change', () => {
          previewStyle.textContent = editorInstance.getValue();
        });
      }
    }

    // --- 3. ACTIONS ---

    function saveEditor(type) {
      const content = editorInstance.getValue();
      localStorage.setItem(CONFIG[type].key, content);
      showToast('success', 'Settings Saved Successfully');
    }

    function resetEditor(type) {
      if(confirm('Are you sure you want to reset code? This cannot be undone.')) {
        editorInstance.setValue(CONFIG[type].default);
        saveEditor(type); // Save the reset state
        showToast('warn', 'Editor Reset to Default');
      }
    }

    function copyEditor(type) {
      const content = editorInstance.getValue();
      navigator.clipboard.writeText(content).then(() => {
        showToast('info', 'Code Copied to Clipboard');
      });
    }

    function downloadEditor(type) {
      const content = editorInstance.getValue();
      const ext = type === 'css' ? 'css' : 'js';
      const blob = new Blob([content], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `poke-custom.${ext}`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      showToast('info', 'Download Started');
    }

    // --- 4. UTILS ---

    function showToast(type, msg) {
      const container = document.getElementById('toaster');
      const el = document.createElement('div');
      el.className = 'toast';
      
      let icon = 'fa-check-circle';
      if(type === 'warn') icon = 'fa-exclamation-triangle';
      if(type === 'info') icon = 'fa-info-circle';

      el.innerHTML = `<i class="fa-solid ${icon}"></i> <span>${msg}</span>`;
      container.appendChild(el);

      setTimeout(() => {
        el.style.opacity = '0';
        el.style.transform = 'translateY(20px)';
        setTimeout(() => el.remove(), 300);
      }, 3000);
    }
  </script>
</body>
</html>