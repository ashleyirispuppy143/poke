 <!--
    This Source Code Form is subject to the terms of the GNU General Public License:

    Copyright (C) 2021-2026 PokeTube (https://codeberg.org/Ashley/poketube)
    
    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program. If not, see https://www.gnu.org/licenses/.
-->

<% const languageOptions = [
  { code: 'autodetect', name: 'Detect Language' },
  { code: 'af', name: 'Afrikaans' },
  { code: 'sq', name: 'Albanian' },
  { code: 'am', name: 'Amharic' },
  { code: 'ar', name: 'Arabic' },
  { code: 'hy', name: 'Armenian' },
  { code: 'as', name: 'Assamese' },
  { code: 'ay', name: 'Aymara' },
  { code: 'az', name: 'Azerbaijani' },
  { code: 'bm', name: 'Bambara' },
  { code: 'eu', name: 'Basque' },
  { code: 'be', name: 'Belarusian' },
  { code: 'bn', name: 'Bengali' },
  { code: 'bh', name: 'Bhojpuri' },
  { code: 'bs', name: 'Bosnian' },
  { code: 'bg', name: 'Bulgarian' },
  { code: 'ca', name: 'Catalan' },
  { code: 'ceb', name: 'Cebuano' },
  { code: 'ny', name: 'Chichewa' },
  { code: 'zh-cn', name: 'Chinese (Simplified)' },
  { code: 'zh-tw', name: 'Chinese (Traditional)' },
  { code: 'co', name: 'Corsican' },
  { code: 'hr', name: 'Croatian' },
  { code: 'cs', name: 'Czech' },
  { code: 'da', name: 'Danish' },
  { code: 'dv', name: 'Dhivehi' },
  { code: 'doi', name: 'Dogri' },
  { code: 'nl', name: 'Dutch' },
  { code: 'en', name: 'English' },
  { code: 'eo', name: 'Esperanto' },
  { code: 'et', name: 'Estonian' },
  { code: 'ee', name: 'Ewe' },
  { code: 'tl', name: 'Filipino' },
  { code: 'fi', name: 'Finnish' },
  { code: 'fr', name: 'French' },
  { code: 'fy', name: 'Frisian' },
  { code: 'gl', name: 'Galician' },
  { code: 'ka', name: 'Georgian' },
  { code: 'de', name: 'German' },
  { code: 'el', name: 'Greek' },
  { code: 'gn', name: 'Guarani' },
  { code: 'gu', name: 'Gujarati' },
  { code: 'ht', name: 'Haitian Creole' },
  { code: 'ha', name: 'Hausa' },
  { code: 'haw', name: 'Hawaiian' },
  { code: 'he', name: 'Hebrew' },
  { code: 'hi', name: 'Hindi' },
  { code: 'hmn', name: 'Hmong' },
  { code: 'hu', name: 'Hungarian' },
  { code: 'is', name: 'Icelandic' },
  { code: 'ig', name: 'Igbo' },
  { code: 'ilo', name: 'Ilocano' },
  { code: 'id', name: 'Indonesian' },
  { code: 'ga', name: 'Irish' },
  { code: 'it', name: 'Italian' },
  { code: 'ja', name: 'Japanese' },
  { code: 'jv', name: 'Javanese' },
  { code: 'kn', name: 'Kannada' },
  { code: 'kk', name: 'Kazakh' },
  { code: 'km', name: 'Khmer' },
  { code: 'rw', name: 'Kinyarwanda' },
  { code: 'kok', name: 'Konkani' },
  { code: 'ko', name: 'Korean (PROK)' },
  { code: 'kri', name: 'Krio' },
  { code: 'ku', name: 'Kurdish (Kurmanji)' },
  { code: 'sd', name: 'Sindhi' },
  { code: 'si', name: 'Sinhala' },
  { code: 'sk', name: 'Slovak' },
  { code: 'sl', name: 'Slovenian' },
  { code: 'so', name: 'Somali' },
  { code: 'es', name: 'Spanish' },
  { code: 'su', name: 'Sundanese' },
  { code: 'sw', name: 'Swahili' },
  { code: 'sv', name: 'Swedish' },
  { code: 'tg', name: 'Tajik' },
  { code: 'ta', name: 'Tamil' },
  { code: 'tt', name: 'Tatar' },
  { code: 'te', name: 'Telugu' },
  { code: 'th', name: 'Thai' },
  { code: 'ti', name: 'Tigrinya' },
  { code: 'ts', name: 'Tsonga' },
  { code: 'tr', name: 'Turkish' },
  { code: 'tk', name: 'Turkmen' },
  { code: 'twi', name: 'Twi' },
  { code: 'uk', name: 'Ukrainian' },
  { code: 'ur', name: 'Urdu' },
  { code: 'ug', name: 'Uyghur' },
  { code: 'uz', name: 'Uzbek' },
  { code: 'vi', name: 'Vietnamese' },
  { code: 'cy', name: 'Welsh' },
  { code: 'xh', name: 'Xhosa' },
  { code: 'yi', name: 'Yiddish' },
  { code: 'yo', name: 'Yoruba' },
  { code: 'zu', name: 'Zulu' }
]; %>

<!doctype html>
<html lang="en">
<head>
<title>PokeTranslate</title>
    <link rel="icon" href="/static/yt-ukraine.svg">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta content="PokeTranslate" property=og:title>
    <meta content="Translate text - Anonymously!" property=twitter:description>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline'">
    <meta name="referrer" content="no-referrer">
    <link rel="manifest" href="/manifest.json">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.bunny.net/icon?family=Material+Icons" rel="stylesheet">
    
  <style>
    :root {
      /* Light Mode Variables */
      --primary: #1a73e8; /* Google Blue */
      --primary-hover: #1765cc;
      --bg-body: #f1f3f4;
      --surface: #ffffff;
      --border: #dadce0;
      --text-main: #202124;
      --text-muted: #5f6368;
      --divider: #e8eaed;
      --shadow: 0 1px 2px 0 rgba(60,64,67,0.3), 0 1px 3px 1px rgba(60,64,67,0.15);
      
      --radius: 8px;
      --nav-height: 64px;
    }

    @media (prefers-color-scheme: dark) {
      :root {
        /* Dark Mode Variables */
        --primary: #8ab4f8;
        --primary-hover: #aecbfa;
        --bg-body: #202124;
        --surface: #303134;
        --border: #5f6368;
        --text-main: #e8eaed;
        --text-muted: #9aa0a6;
        --divider: #3c4043;
        --shadow: 0 1px 3px 0 rgba(0,0,0,0.4);
      }
    }

    * { margin:0; padding:0; box-sizing:border-box; }

    body {
      font-family: 'Roboto', sans-serif;
      background: var(--bg-body);
      color: var(--text-main);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      transition: background 0.3s, color 0.3s;
    }

    /* Navbar */
    header {
      background: var(--surface);
      height: var(--nav-height);
      display: flex;
      align-items: center;
      padding: 0 24px;
      border-bottom: 1px solid var(--divider);
      position: sticky;
      top: 0;
      z-index: 10;
    }

    header h1 {
      font-size: 22px;
      font-weight: 500;
      color: var(--text-muted);
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    header h1 span {
        color: var(--text-main);
    }

    /* Main Container */
    main {
      flex: 1;
      width: 100%;
      max-width: 1280px;
      margin: 0 auto;
      padding: 24px;
    }

    .translate-card {
      background: var(--surface);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      border: 1px solid var(--divider);
      overflow: hidden;
      min-height: 300px;
      display: flex;
      flex-direction: column;
    }

    /* Language Toolbar */
    .language-toolbar {
      display: flex;
      align-items: center;
      border-bottom: 1px solid var(--divider);
      height: 56px;
      padding: 0 8px;
      background: var(--surface);
    }

    .lang-group {
      flex: 1;
      display: flex;
      align-items: center;
      position: relative;
    }

    /* Custom Select Styling */
    .select-wrapper {
        position: relative;
        display: inline-block;
        width: 100%;
        max-width: 200px;
    }

    .select-wrapper select {
      appearance: none;
      background: transparent;
      border: none;
      font-family: inherit;
      font-size: 14px;
      font-weight: 500;
      color: var(--primary);
      padding: 12px 32px 12px 16px;
      width: 100%;
      cursor: pointer;
      border-radius: 4px;
      transition: background 0.2s;
    }

    .select-wrapper select:hover {
      background: rgba(26, 115, 232, 0.04);
    }
    
    @media (prefers-color-scheme: dark) {
        .select-wrapper select:hover { background: rgba(138, 180, 248, 0.08); }
    }

    /* Arrow icon for select */
    .select-wrapper::after {
      content: 'â–¼';
      font-size: 10px;
      color: var(--text-muted);
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      pointer-events: none;
    }

    .swap-btn {
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      color: var(--text-muted);
      text-decoration: none;
      transition: background 0.2s, transform 0.2s;
      margin: 0 8px;
    }

    .swap-btn:hover {
      background: rgba(60, 64, 67, 0.08);
      color: var(--text-main);
    }

    /* Input/Output Grid */
    .editor-grid {
      display: grid;
      grid-template-columns: 1fr 1px 1fr;
      flex: 1;
      position: relative;
    }

    .vertical-divider {
      background: var(--divider);
      width: 1px;
      height: 100%;
    }

    .editor-panel {
      padding: 20px;
      display: flex;
      flex-direction: column;
    }

    .editor-panel textarea {
      width: 100%;
      border: none;
      resize: none;
      background: transparent;
      font-family: inherit;
      font-size: 24px;
      line-height: 1.4;
      color: var(--text-main);
      outline: none;
      min-height: 150px;
      overflow: hidden;
    }

    .editor-panel textarea::placeholder {
      color: var(--text-muted);
    }

    .output-panel {
      background: rgba(241, 243, 244, 0.5); /* Slight tint for output area like old GT */
    }
    @media (prefers-color-scheme: dark) {
        .output-panel { background: rgba(0,0,0,0.1); }
    }

    /* Actions Footer inside card */
    .card-footer {
        padding: 12px 24px;
        display: flex;
        justify-content: flex-end;
        align-items: center;
        background: var(--surface);
    }

    .translate-submit {
      background: var(--primary);
      color: #fff;
      border: none;
      padding: 10px 24px;
      border-radius: 4px;
      font-weight: 500;
      font-size: 14px;
      cursor: pointer;
      box-shadow: 0 1px 2px rgba(0,0,0,0.2);
      transition: background 0.2s, box-shadow 0.2s;
    }

    .translate-submit:hover {
      background: var(--primary-hover);
      box-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }
    
    /* Footer/Credits */
    .site-footer {
        text-align: center;
        padding: 24px;
        color: var(--text-muted);
        font-size: 0.85rem;
    }

    /* Responsive */
    @media (max-width: 768px) {
      main { padding: 12px; }
      
      .translate-card {
        height: auto;
      }

      .editor-grid {
        grid-template-columns: 1fr;
        grid-template-rows: auto 1px auto;
      }

      .vertical-divider {
        width: 100%;
        height: 1px;
      }
      
      .language-toolbar {
          height: auto;
          flex-wrap: wrap;
          padding: 12px;
          gap: 12px;
      }
      
      .lang-group {
          min-width: 40%;
          justify-content: center;
      }
      
      .select-wrapper { max-width: 100%; }
      
      .editor-panel textarea { font-size: 20px; }
    }
  </style>

  <noscript>
    <style>
      .card-footer { display: flex !important; }
    </style>
  </noscript>
</head>
<body>

  <header>
    <h1>
       <span class="material-icons" style="font-size: 32px; color: var(--primary); margin-right: 8px;">translate</span>
       <span>Poke</span>Translate
    </h1>
  </header>

  <main>
    <form action="/translate" method="GET" class="translate-card">
      
      <div class="language-toolbar">
        <div class="lang-group">
          <div class="select-wrapper">
            <select name="from_language" id="from_language">
              <% languageOptions.forEach(lang => { %>
                <option value="<%= lang.code %>" <%= lang.code === (from_language||'autodetect')?'selected':''%>>
                  <%= lang.name %>
                </option>
              <% }); %>
            </select>
          </div>
        </div>

        <a href="?from_language=<%= to_language %>&to_language=<%= from_language %>&input=<%= encodeURIComponent(text) %>"
           id="swapBtn"
           class="material-icons swap-btn"
           title="Swap languages">
           swap_horiz
        </a>

        <div class="lang-group" style="justify-content: flex-end;">
          <div class="select-wrapper">
             <select name="to_language" id="to_language">
              <% languageOptions.slice(1).forEach(lang => { %>
                <option value="<%= lang.code %>" <%= lang.code===to_language?'selected':''%>>
                  <%= lang.name %>
                </option>
              <% }); %>
            </select>
          </div>
        </div>
      </div>

      <div class="editor-grid">
        <div class="editor-panel input-panel">
          <textarea id="input" name="input" placeholder="Enter text" spellcheck="false"><%= text %></textarea>
        </div>
        
        <div class="vertical-divider"></div>

        <div class="editor-panel output-panel">
          <textarea id="output" readonly placeholder="Translation"><%= translation %></textarea>
        </div>
      </div>

      <div class="card-footer">
        <button type="submit" class="translate-submit">Translate</button>
      </div>
      
    </form>
  </main>
  
  <div class="site-footer">
    <p>&copy; 2021-2026 PokeTranslate </p>
  </div>

  <script>
  (function(){
    // swap button logic
    const swapBtn = document.getElementById('swapBtn');
    if(swapBtn){
      swapBtn.addEventListener('click', function(e){
        e.preventDefault();
        const from = document.getElementById('from_language');
        const to   = document.getElementById('to_language');
        const inp  = document.getElementById('input');
        const out  = document.getElementById('output');
        
        // Value swap
        [from.value, to.value] = [to.value, from.value];
        [inp.value, out.value] = [out.value, inp.value];
        
        // Trigger change events for logic hooks
        from.dispatchEvent(new Event('change'));
        to.dispatchEvent(new Event('change'));
        inp.dispatchEvent(new Event('input'));
      });
    }

    // auto-resize textareas
    const textareas = document.querySelectorAll('textarea');
    const resize = (el) => {
        el.style.height = 'auto';
        el.style.height = el.scrollHeight + 'px';
    };
    
    textareas.forEach(el => {
      el.addEventListener('input', () => resize(el));
      // initial resize
      resize(el);
    });

    // live-translate logic
    if(window.fetch){
      const from  = document.getElementById('from_language');
      const to    = document.getElementById('to_language');
      const input = document.getElementById('input');
      const output= document.getElementById('output');
      let timer;

      function translateNow(){
        // Don't translate empty text
        if(!input.value.trim()) {
            output.value = "";
            return;
        }

        const q = new URLSearchParams({
          from_language: from.value,
          to_language: to.value,
          input: input.value
        });
        
        fetch(`/translate?${q}`)
          .then(r => r.text())
          .then(html => {
            const doc = new DOMParser().parseFromString(html, 'text/html');
            const newOut = doc.getElementById('output');
            if(newOut){
              output.value = newOut.value;
              resize(output);
            }
          })
          .catch(() => {/* ignore */});
      }

      // Debounce typing (Wait 800ms after typing stops)
      input.addEventListener('input', ()=>{
        clearTimeout(timer);
        timer = setTimeout(translateNow, 800);
      });
      
      from.addEventListener('change', translateNow);
      to.addEventListener('change', translateNow);
    }
  })();
  </script>
</body>
</html>